# Как использовать локальные node-пакеты в качестве зависимостей проекта. #

перевод [статьи Генри Блей-Романа](https://www.viget.com/articles/how-to-use-local-unpublished-node-packages-as-project-dependencies/)

Тестируйте ещё не опубликованные пакеты, обходя подводные камни, на которые можно наступить при работе с npm и yarn.

Случается, что Вам нужно установить локальный пакет в качестве зависимости на своём проекте. Возможно Вы создаете новый node-модуль для публикации, трудитесь над новым пакетом для его использования только на своих личных проектах или внутри команды, либо участвуете в улучшении уже существующего пакета с открытым кодом. В любом случае, Вам нужно проверить выполненные изменения в коде, прежде чем делать pull-запрос в удаленный репозиторий или публиковать модуль. Как же лучше добавить локальную версию пакета в свой проект для такого тестирования?

Вы можете пушнуть изменения в удаленную ветку, и именно её использовать для установки зависимости. Например при работе с гитхабом Вы можете использовать
команду  `yarn add (npm install) <git remote url>#<branch/commit/tag>` . Но помимо интернет-соединения, такой подход требует постоянно переустанавливать пакет при каждом внесенном в него изменении.

Можно использовать команды `npm add relative/path или yarn add relative/path`, которые скопируют папку с пакетом в каталог с node-модулями проекта. Но этом изменения самого пакета никак не будут отслеживаться, да и относительный путь до папки с ним может быть очень громоздким.
(прим. пер. - в оригинале статьи указана команда `yarn add file:relative/path`, однако корректно работает именно приведенная в переводе, также в оригинале говорится о том, что npm не добавляет в список зависимостей в package.json название пакета при копировании, однако сейчас (01.03.21) -  это не так)

Ещё есть команды `npm link` и `yarn link`. Обе они добавляют в зависимости локальную символическую ссылку ([документация npm link](https://docs.npmjs.com/cli/v7/commands/npm-link), [документация yarn link](https://classic.yarnpkg.com/en/docs/cli/link)). Но у этого решения есть свои [сложности](https://github.com/yarnpkg/yarn/issues/1761) -  имплементации и yarn, и npm
могут доставить кучу хлопот (на момент написания статьи открыто [около 40 вопросов по npm link](https://github.com/npm/cli/search?q=npm-link&type=issues) (прим. пер. - на момент перевода их 227) и [более 150](https://github.com/yarnpkg/yarn/issues?utf8=%E2%9C%93&q=is:issue+is:open+%22yarn+link%22) для yarn link). Если вы уже использовали символические ссылки в качестве зависимостей при разработке своего пакета, наверняка Ваша работа стопорилась из-за какого-нибудь препятствия, будь то неожиданное `unlink` поведение,
проблемы с “peer”-зависимостями и что-то посерьезнее.

Что же тогда делать? Я для себя нашёл ответ - использовать [yalk](https://github.com/wclr/yalc), созданный [@whitecolor](https://medium.com/@_whitecolor).

yalc поддерживает свое хранилище на локальной машине (`~/.yalc`). Публикуете пакет с yalc, и полная копия пакета копируется в хранилище. Устанавливаете пакет из yalc-хранилища - и эта копия добавится в проект практически точно так как при установке пакета из удаленного каталога. Обновили добавленный в хранилище пакет - и изменения доступны для проекта, Вы даже можете опубликовать изменения в хранилище и обновить пакет в проекте одной командой. Во избежание конфликтов yalc хеширует каждую версию пакета, публикуемую в хранилище. И yalc может хранить столько версий пакета, сколько Вам захочется.

yalc позволяет просто и в интуитивно-понятной манере разрабатывать и тестировать пакеты локально. Он отвечает тем ожиданиям, которые Вы возможно возлагали на `(npm|yarn) link`. У yalc есть и другие полезные фичи - можете прочитать в [README](https://github.com/wclr/yalc) об использовании команды add, о продвинутой работой с git и многом другом.

Вот как использовать yalc для работы с локальными пакетами:

## Установка yalc ##

    $  npm install -g yalc   // или `yarn global add yalc`

## Размещение пакета в вашем локальном yalc-хранилище ##

    // в папке разрабатываемого пакета
    $  yalc publish

